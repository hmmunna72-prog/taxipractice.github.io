<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taxi Exam Practice (MCQ)</title>
  <style>
    :root { --card:#fff; --bg:#f6f7fb; --text:#111; --muted:#666; --border:#e6e6ee; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted);font-size:13px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-top:14px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 12px;font-weight:600;cursor:pointer}
    button.primary{background:#111;color:#fff;border-color:#111}
    button:disabled{opacity:.5;cursor:not-allowed}
    .pill{border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .progress{height:10px;background:#eee;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:#111}
    .qtitle{font-weight:700;margin:0 0 10px 0}
    .opt{display:flex;gap:10px;align-items:flex-start;border:1px solid var(--border);border-radius:12px;padding:10px;margin:10px 0;cursor:pointer}
    .opt input{margin-top:3px}
    .muted{color:var(--muted)}
    .split{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media(max-width:820px){.split{grid-template-columns:1fr}}
    .reviewItem{border-top:1px dashed var(--border);padding-top:12px;margin-top:12px}
    .ok{color: #0a7a2f; font-weight:700}
    .bad{color: #b00020; font-weight:700}
    code.inline{background:#f0f0f5;border:1px solid var(--border);padding:2px 6px;border-radius:8px}
    textarea{width:100%;min-height:180px;border-radius:12px;border:1px solid var(--border);padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Taxi Exam Practice (MCQ)</h1>
        <div class="sub">Select answers ‚Üí Submit ‚Üí See score & review</div>
      </div>
      <div class="row">
        <span class="pill" id="metaPill">Loading‚Ä¶</span>
        <button id="shuffleBtn">Shuffle</button>
        <button id="resetBtn">Reset</button>
      </div>
    </header>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="pill" id="progressText">Question 0 / 0</div>
        <div class="pill" id="scoreText">Score: ‚Äî</div>
      </div>
      <div class="progress" style="margin-top:10px"><div class="bar" id="bar"></div></div>
    </div>

    <div class="split">
      <div class="card" id="quizCard">
        <p class="muted" style="margin-top:0">
          If you still see 404 on your Pages link, use the Pages URL shown in repo <b>Settings ‚Üí Pages</b>.
        </p>

        <h2 class="qtitle" id="qTitle">Loading‚Ä¶</h2>
        <div id="options"></div>

        <div class="row" style="justify-content:space-between;margin-top:14px">
          <button id="prevBtn">‚Üê Prev</button>
          <div class="row">
            <button id="submitBtn" class="primary">Submit</button>
            <button id="nextBtn">Next ‚Üí</button>
          </div>
        </div>
        <p class="muted" id="hint" style="margin-bottom:0"></p>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Result</h3>
        <div id="resultBox" class="muted">Submit to see results.</div>

        <h3>Review</h3>
        <div id="reviewBox" class="muted">After submit, wrong answers will show here.</div>

        <h3>How to add ALL questions (easy)</h3>
        <p class="muted">
          Open <code class="inline">questions.js</code> and paste questions in the same format.
          Each question needs: <b>id</b>, <b>text</b>, <b>options</b> (array), <b>answerIndex</b> (0-based).
        </p>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Quick Import Helper (optional)</h3>
      <p class="muted">
        If you copy questions as JSON array (same format as in <code class="inline">questions.js</code>), paste below and click Import.
      </p>
      <textarea id="importArea" placeholder='[{"id":"Q1","text":"...","options":["A","B","C"],"answerIndex":1}]'></textarea>
      <div class="row" style="margin-top:10px">
        <button id="importBtn" class="primary">Import JSON</button>
        <span class="muted" id="importMsg"></span>
      </div>
    </div>
  </div>

  <script src="questions.js"></script>
  <script>
    // questions.js must define: window.QUESTIONS = [...]
    const LS_KEY = "taxi_quiz_state_v1";

    let questions = Array.isArray(window.QUESTIONS) ? [...window.QUESTIONS] : [];
    let state = {
      order: [],
      idx: 0,
      answers: {},   // { [qid]: selectedIndex }
      submitted: false
    };

    const el = (id) => document.getElementById(id);

    function save() {
      localStorage.setItem(LS_KEY, JSON.stringify({ questions, state }));
    }
    function load() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return false;
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed.questions) && parsed.questions.length) questions = parsed.questions;
        if (parsed.state) state = parsed.state;
        return true;
      } catch { return false; }
    }

    function initOrderIfNeeded() {
      if (!Array.isArray(state.order) || state.order.length !== questions.length) {
        state.order = questions.map(q => q.id);
        state.idx = 0;
        state.answers = {};
        state.submitted = false;
      }
    }

    function getQById(id) {
      return questions.find(q => q.id === id);
    }

    function currentQ() {
      const qid = state.order[state.idx];
      return getQById(qid);
    }

    function renderMeta() {
      el("metaPill").textContent = `${questions.length} questions`;
    }

    function renderProgress() {
      const total = questions.length || 1;
      el("progressText").textContent = `Question ${Math.min(state.idx+1,total)} / ${total}`;
      el("bar").style.width = `${(state.idx / total) * 100}%`;
    }

    function renderQuestion() {
      const q = currentQ();
      if (!q) {
        el("qTitle").textContent = "No questions yet.";
        el("options").innerHTML = `<p class="muted">Open <code class="inline">questions.js</code> and add your questions.</p>`;
        el("prevBtn").disabled = true;
        el("nextBtn").disabled = true;
        el("submitBtn").disabled = true;
        el("hint").textContent = "";
        return;
      }

      el("qTitle").textContent = q.text;
      const picked = state.answers[q.id];

      el("options").innerHTML = q.options.map((opt, i) => {
        const checked = picked === i ? "checked" : "";
        return `
          <label class="opt">
            <input type="radio" name="opt" value="${i}" ${checked} ${state.submitted ? "disabled" : ""}/>
            <div>
              <div><b>${String.fromCharCode(65+i)}.</b> ${opt}</div>
            </div>
          </label>
        `;
      }).join("");

      // click handler for radio
      el("options").querySelectorAll('input[type="radio"]').forEach(r => {
        r.addEventListener("change", (e) => {
          state.answers[q.id] = Number(e.target.value);
          save();
          if (!state.submitted) el("hint").textContent = "Saved ‚úÖ";
        });
      });

      el("prevBtn").disabled = state.idx === 0;
      el("nextBtn").disabled = state.idx >= questions.length - 1;
      el("submitBtn").disabled = questions.length === 0;

      if (!state.submitted) el("hint").textContent = "Select an option, then Next. Submit anytime.";
      else el("hint").textContent = "Submitted. Review on the right.";
      renderProgress();
      renderScore(false);
    }

    function calcScore() {
      let correct = 0, answered = 0;
      for (const q of questions) {
        if (state.answers[q.id] !== undefined) {
          answered++;
          if (state.answers[q.id] === q.answerIndex) correct++;
        }
      }
      return { correct, answered, total: questions.length };
    }

    function renderScore(showReview) {
      const { correct, answered, total } = calcScore();
      el("scoreText").textContent = `Score: ${state.submitted ? correct + " / " + total : "‚Äî"}`;

      if (!state.submitted) {
        el("resultBox").textContent = `Answered: ${answered}/${total}. (Submit to see score.)`;
        el("reviewBox").textContent = "After submit, wrong answers will show here.";
        return;
      }

      el("resultBox").innerHTML = `
        <div><b>Total:</b> ${total}</div>
        <div><b>Answered:</b> ${answered}</div>
        <div><b>Correct:</b> <span class="ok">${correct}</span></div>
        <div><b>Wrong:</b> <span class="bad">${total - correct}</span></div>
      `;

      if (!showReview) return;

      const wrong = questions.filter(q => state.answers[q.id] !== q.answerIndex);
      if (!wrong.length) {
        el("reviewBox").innerHTML = `<div class="ok">All correct üéâ</div>`;
        return;
      }

      el("reviewBox").innerHTML = wrong.map(q => {
        const picked = state.answers[q.id];
        const pickedText = picked === undefined ? "(No answer)" : `${String.fromCharCode(65+picked)}. ${q.options[picked]}`;
        const correctText = `${String.fromCharCode(65+q.answerIndex)}. ${q.options[q.answerIndex]}`;
        return `
          <div class="reviewItem">
            <div><b>${q.id}</b> ‚Äî ${q.text}</div>
            <div class="bad">Your answer: ${pickedText}</div>
            <div class="ok">Correct: ${correctText}</div>
          </div>
        `;
      }).join("");
    }

    function submit() {
      state.submitted = true;
      save();
      renderQuestion();
      renderScore(true);
      // move progress bar to 100% visual
      el("bar").style.width = "100%";
    }

    function next() {
      if (state.idx < questions.length - 1) state.idx++;
      save();
      renderQuestion();
    }
    function prev() {
      if (state.idx > 0) state.idx--;
      save();
      renderQuestion();
    }

    function shuffle() {
      // Fisher-Yates
      for (let i = state.order.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [state.order[i], state.order[j]] = [state.order[j], state.order[i]];
      }
      state.idx = 0;
      save();
      renderQuestion();
    }

    function resetAll() {
      localStorage.removeItem(LS_KEY);
      state = { order: questions.map(q => q.id), idx: 0, answers: {}, submitted: false };
      save();
      renderQuestion();
      renderScore(false);
      el("importMsg").textContent = "";
      el("importArea").value = "";
    }

    function importJSON() {
      try {
        const text = el("importArea").value.trim();
        const arr = JSON.parse(text);
        if (!Array.isArray(arr) || !arr.length) throw new Error("Not an array");
        // basic validate
        for (const q of arr) {
          if (!q.id || !q.text || !Array.isArray(q.options) || typeof q.answerIndex !== "number") {
            throw new Error("Invalid question format");
          }
        }
        questions = arr;
        state = { order: questions.map(q => q.id), idx: 0, answers: {}, submitted: false };
        save();
        renderMeta();
        renderQuestion();
        el("importMsg").textContent = "Imported ‚úÖ";
      } catch (e) {
        el("importMsg").textContent = "Import failed. Paste valid JSON array.";
      }
    }

    // init
    load();
    initOrderIfNeeded();
    renderMeta();
    renderQuestion();

    el("nextBtn").addEventListener("click", next);
    el("prevBtn").addEventListener("click", prev);
    el("submitBtn").addEventListener("click", submit);
    el("shuffleBtn").addEventListener("click", shuffle);
    el("resetBtn").addEventListener("click", resetAll);
    el("importBtn").addEventListener("click", importJSON);
  </script>
</body>
</html>
